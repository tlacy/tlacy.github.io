/* Lightweight sanitizer as a vendored fallback.
   This is NOT the full DOMPurify implementation. It provides a simple
   sanitize(input) function that removes script/style/iframe/object/embed
   elements and strips event handler attributes (on*). For more robust
   sanitization, replace this file with the official DOMPurify build.
*/
(function(window){
  'use strict';
  function sanitize(input){
    if(!input) return '';
    var wrapper = document.createElement('div');
    try{
      wrapper.innerHTML = input;
    }catch(e){
      return '';
    }
    var forbidden = ['script','style','iframe','object','embed'];
    var walker = document.createTreeWalker(wrapper, NodeFilter.SHOW_ELEMENT, null, false);
    var node;
    while(node = walker.nextNode()){
      var name = node.nodeName.toLowerCase();
      if(forbidden.indexOf(name) !== -1){
        node.parentNode.removeChild(node);
        continue;
      }
      // Remove on* attributes and javascript: hrefs
      var attrs = Array.prototype.slice.call(node.attributes || []);
      attrs.forEach(function(a){
        var an = a.name || '';
        var val = a.value || '';
        if(/^on/i.test(an)) node.removeAttribute(an);
        if(an === 'href' && !/^(https?:|mailto:|\/)/i.test(val)) node.removeAttribute('href');
      });
    }
    return wrapper.innerHTML;
  }
  window.DOMPurify = window.DOMPurify || { sanitize: sanitize };
})(this);
